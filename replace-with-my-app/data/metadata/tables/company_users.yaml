---
table: company_users

#############
# relations #
#############
object_relationships:
  - name: company
    using:
      foreign_key_constraint_on: company_id
  - name: user
    using:
      foreign_key_constraint_on: user_id

###############
# permissions #
###############
# insert_permissions:
#   - role: company-admin
#     permission:
#       check:
#         _or:
#           &my-company-or-one-i-created-or-company-im-broker-of # company agreement is for a company I'm an admin of
#           - company_id:
#               _in: X-Hasura-Companies
#           # company agreement is for a company I created
#           - company:
#               created_by_user_id:
#                 _eq: X-Hasura-User-Id
#           # company agreement is for a company I'm a broker of
#           - company:
#               broker_id:
#                 _in: X-Hasura-Companies
#       columns:
#         - company_id
#         - user_id
#         - role
#   - role: support
#     permission:
#       columns:
#         - company_id
#         - user_id
#         - role
# select_permissions:
#   - role: company-admin
#     permission: &select_permissions:company-admin:permission
#       allow_aggregations: true
#       columns:
#         - company_id
#         - user_id
#         - role
#       filter: &select_permissions:company-admin:permission:filter
#         _or: *my-company-or-one-i-created-or-company-im-broker-of
#   - role: company-user
#     permission: *select_permissions:company-admin:permission
#   - role: support
#     permission:
#       allow_aggregations: true
#       columns:
#         - company_id
#         - user_id
#         - role
# update_permissions:
#   - role: company-admin
#     permission:
#       columns:
#         - user_id
#         - role
#       filter: *select_permissions:company-admin:permission:filter
#   - role: support
#     permission:
#       columns:
#         - user_id
#         - role
# delete_permissions:
#   - role: company-admin
#     permission:
#       filter: *select_permissions:company-admin:permission:filter
#   - role: support
#     permission:
#       filter: {}

############
#  events  #
############
# event_triggers:
#   - name: invite-company-user
#     definition:
#       enable_manual: true
#       insert:
#         columns: '*'
#     headers:
#       - name: x-api-key
#         value_from_env: HASURA_EVENTS_KEY
#     retry_conf:
#       interval_sec: 10
#       num_retries: 0
#       timeout_sec: 60
#     webhook_from_env: HASURA_EVENTS_URL
