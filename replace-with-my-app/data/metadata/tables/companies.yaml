---
table: companies

#############
# relations #
#############
array_relationships:
  - name: company_doing_business_as
    using:
      foreign_key_constraint_on:
        column: company_id
        table: company_doing_business_as
  - name: company_users
    using:
      foreign_key_constraint_on:
        column: company_id
        table: company_users
  - name: provider_locations
    using:
      foreign_key_constraint_on:
        column: company_id
        table: provider_locations
object_relationships:
  - name: created_by_user
    using:
      foreign_key_constraint_on: created_by_user_id
  - name: physical_address
    using:
      foreign_key_constraint_on: physical_address_id

###############
# permissions #
###############
# insert_permissions:
#   - role: company-admin
#     permission: &insert_permissions:company-admin:permission
#       columns: &insert_permissions:company-admin:permission:columns
#         - broker_id
#         - business_type
#         - effective_date
#         - federal_tax_id_number
#         - financial_email
#         - hr_email
#         - legal_name
#         - national_provider_id
#         - phone_number
#         - physical_address_id
#         - primary_industry_sic_code
#       set:
#         created_by_user_id: X-Hasura-User-Id
#   - role: support
#     permission: *insert_permissions:company-admin:permission
# select_permissions:
#   - role: company-admin
#     permission: &select_permissions:company-admin:permission
#       allow_aggregations: true
#       columns: &select_permissions:company-admin:permission:columns
#         - *insert_permissions:company-admin:permission:columns
#         - created_at
#         - created_by_user_id
#         - expiry_date
#         - id
#         - updated_at
#       filter: &select_permissions:company-admin:permission:filter
#         _and:
#           - &is-not-deleted
#             deleted_at:
#               _is_null: true
#           - _or:
#               - id:
#                   _in: X-Hasura-Companies
#               - broker_id:
#                   _in: X-Hasura-Companies
#               - brokered_companies:
#                   id:
#                     _in: X-Hasura-Companies
#   - role: company-user
#     permission: *select_permissions:company-admin:permission
#   - role: member
#     permission:
#       allow_aggregations: false
#       columns:
#         - effective_date
#         - expiry_date
#         - id
#         - legal_name
#       filter:
#         _and:
#           - *is-not-deleted
#           - patients:
#               _or:
#                 - id:
#                     _eq: X-Hasura-Member-Id
#                 - main_member_id:
#                     _eq: X-Hasura-Member-Id
#   - role: support
#     permission:
#       allow_aggregations: true
#       columns:
#         - *select_permissions:company-admin:permission:columns
#         - deleted_at
# update_permissions:
#   - role: company-admin
#     permission:
#       columns: &update_permissions:company-admin:permission:columns
#         - *insert_permissions:company-admin:permission:columns
#         - deleted_at
#       filter: *select_permissions:company-admin:permission:filter
#   - role: support
#     permission:
#       columns: *update_permissions:company-admin:permission:columns

############
#  events  #
############
# event_triggers:
#   - name: insert-company-broker-id
#     definition:
#       enable_manual: true
#       insert:
#         columns: '*'
#     headers:
#       - name: x-api-key
#         value_from_env: HASURA_EVENTS_KEY
#     retry_conf:
#       interval_sec: 10
#       num_retries: 0
#       timeout_sec: 60
#     webhook_from_env: HASURA_EVENTS_URL
